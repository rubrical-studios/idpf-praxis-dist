# Deployment Awareness
**Version:** v0.34.2

**Purpose:** Document the deployment chain from development to distribution

---

## Overview

This repository (`idpf-praxis`) is the **development environment**. Changes made here must be evaluated for deployment impact to the **distribution repository** (`idpf-praxis-dist`) which users install from.

---

## Deployment Architecture

### Source of Truth Chain

```
idpf-praxis (Development)              idpf-praxis-dist (Distribution)
──────────────────────────              ─────────────────────────────────────
Source Files (IDPF-*, Reference/, etc.)
    │
    ↓ /minimize-files
    │
.min-mirror/                     ────→  Deployed via deploy-dist.yml
    │                                   (on git tag push v*)
    ↓ /prepare-release
    │
.claude/rules/                          Users get rules via install.js
```

### Command Template Chain

```
.claude/commands/*.md (SOURCE)    ────→  .min-mirror/Templates/commands/*.md
    │                                     (via path remapping in minimize-config.json)
    │                                     │
    │ FRAMEWORK-ONLY content              │ FRAMEWORK-ONLY stripped
    │ (e.g., validation file refs)        │ (users get empty extension blocks)
    ↓                                     ↓
Framework uses full commands              Users get clean templates
```

**Note:** `Templates/commands/` no longer exists. Commands are sourced from `.claude/commands/` with path remapping.

### Trigger

Deployment to `-dist` is triggered by pushing a git tag matching `v*` (e.g., `v0.15.0`).

---

## File Classification

### Deployed FROM `.min-mirror/`

These directories are minimized and deployed to the distribution repo:

| Directory | Content |
|-----------|---------|
| `IDPF-*` | All framework directories (10 total) |
| `Overview/` | Framework summaries and references |
| `Reference/` | GitHub Workflow, Session Startup, etc. |
| `System-Instructions/` | Core instructions and Domain Selection Guide |
| `Assistant/` | Anti-hallucination rules (user-facing only) |
| `Templates/` | Command templates and lifecycle artifacts |

### Deployed DIRECTLY (Not Minimized)

| Directory | Source | Notes |
|-----------|--------|-------|
| `Skills/Packaged/` | `Skills/Packaged/*.zip` | Skill zip files for installation |

**Note:** Skills are distributed as zip files only. The installer extracts skills on demand from `Skills/Packaged/`. The source skill directories (`Skills/[name]/`) are NOT minimized or deployed.

### Deployed AS-IS (Not Minimized)

These files are copied directly without minimization:

| File/Directory | Notes |
|----------------|-------|
| `README-DIST.md` | Becomes `README.md` in -dist |
| `CHANGELOG.md` | Release history |
| `LICENSE` | MIT license |
| `install.js` | Installation script |
| `fetch-updates.js` | Update checker |
| `framework-manifest.json` | Framework metadata |

### Dev-Only (Never Deployed)

These stay in the development repo only:

| Category | Examples |
|----------|----------|
| **Excluded Directories** | `Archive/`, `Proposal/`, `PRD/`, `Guides/`, `Market-Analysis/`, `Draft-Diagrams/` |
| **Excluded Files** | `Assistant/Anti-Hallucination-Rules-for-Framework-Development.md` (framework maintainers only) |
| **Excluded Commands** | `/prepare-release`, `/minimize-files`, `/skill-validate`, `/audit-*`, `/gap-analysis` |
| **Skill Sources** | `Skills/[name]/` directories (only `Skills/Packaged/*.zip` is deployed) |
| **Build Artifacts** | `.claude/rules/` (generated by install.js for users) |

---

## Quick Reference

### Minimization Scope

Defined in `.claude/scripts/framework/minimize-config.json`:

```json
{
  "includedDirectories": [
    "IDPF-*", "Overview", "Reference",
    "System-Instructions", "Assistant", ".claude/commands",
    "Templates"
  ],
  "excludedFiles": [
    "Assistant/Anti-Hallucination-Rules-for-Framework-Development.md"
  ],
  "excludedDirectories": [
    "Archive", "Proposal", "PRD", ".claude/rules",
    "Guides", "Market-Analysis", "Templates/commands"
  ],
  "pathRemappings": {
    ".claude/commands": "Templates/commands"
  }
}
```

**Notes:**
- `.claude/commands/` is the source for command templates, remapped to `.min-mirror/Templates/commands/`
- `Templates/commands/` is excluded (no longer exists - commands sourced from `.claude/commands/`)
- `FRAMEWORK-ONLY` tagged content is stripped during minimization
- Skills is NOT in `includedDirectories` because skill source files are not minimized

### Key Commands

| Command | Purpose |
|---------|---------|
| `/minimize-files` | Update `.min-mirror/` from source files |
| `/minimize-files orphans` | Find orphaned files in `.min-mirror/` |
| `/minimize-files reset` | Force full rebuild of `.min-mirror/` |
| `/prepare-release` | Full release preparation including minimization |

---

## Related Files

| File | Purpose |
|------|---------|
| `.github/workflows/deploy-dist.yml` | Deployment workflow |
| `.claude/scripts/minimize-config.json` | Minimization scope |
| `.claude/commands/minimize-files.md` | Minimization command |
| `.claude/commands/prepare-release.md` | Release preparation |
| `install.js` | User installation script |

---

**End of Deployment Awareness**
