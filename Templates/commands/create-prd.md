---
version: "v0.27.0"
description: Transform proposal into Agile PRD
argument-hint: "<proposal-path> | extract [<directory>]"
---

<!-- EXTENSIBLE -->
# /create-prd

Transform proposal into Agile PRD with user stories, acceptance criteria, and epic groupings.

## Extension Points
| Point | Purpose |
|-------|---------|
| `pre-analysis` | Custom validation, preprocessing |
| `post-analysis` | Custom analysis steps |
| `pre-transform` | Pre-transformation hooks |
| `post-transform` | Story validation, enrichment |
| `pre-diagram` | Diagram setup |
| `post-diagram` | Diagram post-processing |
| `pre-generation` | Template customization |
| `post-generation` | Custom finalization |
| `diagram-generator` | Replace default draw.io generator |
| `quality-checklist` | Additional validation rules |

---

## Prerequisites
- Proposal exists in `Proposal/`
- (Recommended) Charter: `CHARTER.md` + `Inception/` artifacts

## Arguments
| Argument | Description |
|----------|-------------|
| `<proposal-path>` | Path to proposal (e.g., `Proposal/Feature-X.md`) |
| `extract` | Extract PRD from codebase (requires `/charter` first) |
| `extract <directory>` | Extract from specific directory |

## Modes
| Mode | Invocation | Description |
|------|------------|-------------|
| **Promote** | `/create-prd Proposal/Feature.md` | Transform proposal (default) |
| **Extract** | `/create-prd extract` | Extract from codebase |
| **Interactive** | `/create-prd` | Prompt for mode selection |

---

## Workflow (Promote Mode)

### Phase 1: Load Context
Load: `<proposal-path>` (required), `CHARTER.md`, `Inception/Scope-Boundaries.md`, `Inception/Constraints.md`, `Inception/Architecture.md`

**Anti-Hallucination Rules:** `.min-mirror/Assistant/Anti-Hallucination-Rules-for-PRD-Work.md` (selfHosted) or `{frameworkPath}/Assistant/...`

<!-- USER-EXTENSION-START: pre-analysis -->
<!-- USER-EXTENSION-END: pre-analysis -->

### Phase 2: Validate Against Charter
Compare proposal vs charter scope: Aligned → Proceed | Misaligned → Confirm | Conflicts → Flag
**Resolution:** 1. Expand charter 2. Defer 3. Proceed anyway 4. Revise proposal

### Phase 3: Analyze Proposal Gaps
Detect: Problem statement, Proposed solution, User stories, Acceptance criteria, Priority
Generate questions for missing elements.

<!-- USER-EXTENSION-START: post-analysis -->
<!-- USER-EXTENSION-END: post-analysis -->

### Phase 4: Dynamic Question Generation
- Reference specific proposal details
- Only ask what's missing
- Allow "skip"/"not sure"
- 3-5 questions at a time

<!-- USER-EXTENSION-START: pre-transform -->
<!-- USER-EXTENSION-END: pre-transform -->

### Phase 4.5: Story Transformation
1. Identify USER (who benefits?)
2. Identify CAPABILITY (what can they do?)
3. Identify BENEFIT (why does it matter?)
4. Transform to story format

**Anti-Pattern:** Flag implementation details → move to Technical Notes.

<!-- USER-EXTENSION-START: post-transform -->
<!-- USER-EXTENSION-END: post-transform -->

### Phase 5: Priority Validation
| Priority | Distribution |
|----------|--------------|
| P0 (Must Have) | ≤40% |
| P1 (Should Have) | 30-40% |
| P2 (Could Have) | ≥20% |

**Exemption:** Skip for PRDs with <6 stories.

<!-- USER-EXTENSION-START: pre-diagram -->
<!-- USER-EXTENSION-END: pre-diagram -->

### Phase 5.5: Diagram Generation (Optional)
| Type | Default | When |
|------|---------|------|
| Use Case | ON | User-facing features |
| Activity | ON | Multi-step workflows |
| Sequence | OFF | API interactions |
| Class | OFF | Data models |
| Component | OFF | Architecture |
| State | OFF | State machines |

<!-- USER-EXTENSION-START: diagram-generator -->
<!-- USER-EXTENSION-END: diagram-generator -->

<!-- USER-EXTENSION-START: post-diagram -->
<!-- USER-EXTENSION-END: post-diagram -->

<!-- USER-EXTENSION-START: pre-generation -->
<!-- USER-EXTENSION-END: pre-generation -->

### Phase 6: Generate PRD
Directory structure:
```
PRD/{PRD-Name}/
├── PRD-{PRD-Name}.md
└── Diagrams/{Epic-Name}/{type}-{desc}.drawio.svg
```

PRD Template:
```markdown
# PRD: <Feature Name>
**Status:** Draft | **Created:** <date> | **Source:** <proposal-path>
---
## Overview
## Epics
### Epic 1: <Theme>
Stories: 1.1, 1.2, 1.3
---
## User Stories
### Story 1.1: <Title>
**As a** <user> **I want** <capability> **So that** <benefit>
**Acceptance Criteria:** - [ ] <criterion>
**Priority:** P0 - Must Have
---
## Diagrams
| Epic | Diagram | Description |
## Technical Notes
> Implementation hints, not requirements.
## Out of Scope
## Dependencies
## Open Questions
---
*Generated by create-prd skill*
```

<!-- USER-EXTENSION-START: post-generation -->
<!-- USER-EXTENSION-END: post-generation -->

<!-- USER-EXTENSION-START: quality-checklist -->
<!-- USER-EXTENSION-END: quality-checklist -->

### Phase 7: Next Steps
Report PRD location, diagrams if generated, offer Create-Backlog.

---

## Workflow (Extract Mode)

### Step 1: Check Inception/
If missing, offer: 1. Run /charter (recommended) 2. Proceed without 3. Cancel

### Step 2: Load Analysis Skill
Load `Skills/codebase-analysis/SKILL.md`

### Step 3-6: Analyze → Validate → Diagrams → Generate
Same as promote mode with confidence levels and evidence citations.

---

## Error Handling
| Situation | Response |
|-----------|----------|
| Proposal not found | Check path prompt |
| No Inception/ | Proceed with limited validation |
| User skips all | Add more to proposal first |
| Empty proposal | Minimum: problem + solution |

## Quality Checklist
- [ ] All stories have acceptance criteria
- [ ] Priorities assigned (P0-P2)
- [ ] Distribution valid (or <6 stories)
- [ ] Technical Notes separated
- [ ] Out of scope stated
- [ ] Open questions flagged
- [ ] Create-Backlog compatible

---

**End of /create-prd Command**
